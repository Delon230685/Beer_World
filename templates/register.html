<!DOCTYPE html>
{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register | Hop & Barley</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Link to your main CSS file -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}">

    <style>
        /* Дополнительные стили для страницы регистрации */
        .error-text {
            color: #dc3545;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .error-message {
            display: block;
        }

        .Input.error {
            border-color: #dc3545;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }

        .password-strength {
            margin-top: 0.5rem;
            font-size: 0.875rem;
        }

        .strength-weak { color: #dc3545; }
        .strength-medium { color: #ffc107; }
        .strength-strong { color: #28a745; }

        .messages {
            width: 100%;
            margin-bottom: 1.5rem;
        }

        .alert {
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0.375rem;
            border: 1px solid transparent;
        }

        .alert-success {
            color: #0f5132;
            background-color: #d1e7dd;
            border-color: #badbcc;
        }

        .alert-error,
        .alert-danger {
            color: #842029;
            background-color: #f8d7da;
            border-color: #f5c2c7;
        }

        .alert-info {
            color: #055160;
            background-color: #cff4fc;
            border-color: #b6effb;
        }

        .alert-warning {
            color: #664d03;
            background-color: #fff3cd;
            border-color: #ffecb5;
        }

        .form-note {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }

        .auth-container--register {
            width: 416px;
            padding: 32px;
            background: var(--background-default);
            border: 1px solid var(--border-default);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
        }

        /* Стили для отображения авторизованного пользователя */
        .header__user-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-name {
            font-size: 14px;
            color: var(--black-main);
            margin-left: 8px;
        }

        /* Форма logout внутри хедера */
        .header__user-actions form {
            margin: 0;
        }

        .header__user-actions .button {
            padding: 8px 16px;
            font-size: 14px;
        }
    </style>
</head>
<body>
<!-- Header -->
<header>
    <div class="header-container">
        <a href="{% url 'home' %}" class="header__logo">
            <img src="{% static 'img/logo.svg' %}" alt="Hop & Barley Logo">
            <p class="logo-text">Hop & Barley</p>
        </a>
        <nav class="header__nav">
            <ul>
                <li><a href="{% url 'home' %}">Products</a></li>
                <li><a href="{% url 'guides_recipes' %}">Guides & Recipes</a></li>
                <li><a href="#">Community</a></li>
                <li><a href="#">Resources</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
        </nav>

        <!-- ВАЖНО: Используем Django шаблоны для проверки аутентификации -->
        {% if user.is_authenticated %}
            <!-- Блок для авторизованного пользователя -->
            <div class="header__user-actions">
                <a href="{% url 'account' %}" class="user-icon" aria-label="My Account">
                    <img src="{% static 'img/icons/User_alt.svg' %}" alt="User Account">
                    <span class="user-name">{{ user.username }}</span>
                </a>
                <a href="{% url 'cart' %}" class="cart-icon" aria-label="Shopping Cart">
                    <img src="{% static 'img/icons/Shopping_bag.svg' %}" alt="Shopping Cart">
                </a>
                <form method="post" action="{% url 'users:logout' %}">
                    {% csrf_token %}
                    <button type="submit" class="button button--secondary">Logout</button>
                </form>
            </div>
        {% else %}
            <!-- Блок для неавторизованного пользователя -->
            <div class="header__auth-buttons">
                <a href="{% url 'users:login' %}" class="button button--secondary">Sign in</a>
                <a href="{% url 'users:register' %}" class="button button--primary">Register</a>
            </div>
        {% endif %}
    </div>
</header>

<!-- Main Content -->
<main class="auth-page-wrapper">
    <div class="auth-background">
        <img src="{% static 'img/background/pattern.jpg' %}" alt="Background pattern">
    </div>
    <div class="auth-form-container">
        <div class="auth-container auth-container--register">
            <div class="Legend">
                <h1 class="auth-title">Create Account</h1>
            </div>

            <!-- Сообщения об ошибках/успехе -->
            {% if messages %}
            <div class="messages">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Форма регистрации -->
            <form class="auth-form" method="post" action="{% url 'users:register' %}" id="register-form">
                {% csrf_token %}

                <!-- Поле username -->
                <div class="InputField">
                    <label for="id_username">Username *</label>
                    <input type="text"
                           name="username"
                           id="id_username"
                           class="Input {% if form.username.errors %}error{% endif %}"
                           value="{% if form.username.value %}{{ form.username.value }}{% endif %}"
                           required
                           placeholder="Choose a unique username"
                           autocomplete="username">
                    {% if form.username.errors %}
                    <div class="error-text">
                        {% for error in form.username.errors %}
                        <span class="error-message">{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <div class="form-note">Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.</div>
                </div>

                <!-- Поле email -->
                <div class="InputField">
                    <label for="id_email">Email *</label>
                    <input type="email"
                           name="email"
                           id="id_email"
                           class="Input {% if form.email.errors %}error{% endif %}"
                           value="{% if form.email.value %}{{ form.email.value }}{% endif %}"
                           required
                           placeholder="Enter your email"
                           autocomplete="email">
                    {% if form.email.errors %}
                    <div class="error-text">
                        {% for error in form.email.errors %}
                        <span class="error-message">{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <!-- Поле phone (необязательное) -->
                <div class="InputField">
                    <label for="id_phone">Phone (optional)</label>
                    <input type="tel"
                           name="phone"
                           id="id_phone"
                           class="Input {% if form.phone.errors %}error{% endif %}"
                           value="{% if form.phone.value %}{{ form.phone.value }}{% endif %}"
                           placeholder="Enter phone number"
                           autocomplete="tel">
                    {% if form.phone.errors %}
                    <div class="error-text">
                        {% for error in form.phone.errors %}
                        <span class="error-message">{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <!-- Поле password1 -->
                <div class="InputField">
                    <label for="id_password1">Password *</label>
                    <input type="password"
                           name="password1"
                           id="id_password1"
                           class="Input {% if form.password1.errors %}error{% endif %}"
                           required
                           placeholder="Create a strong password"
                           autocomplete="new-password">
                    {% if form.password1.errors %}
                    <div class="error-text">
                        {% for error in form.password1.errors %}
                        <span class="error-message">{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <div class="form-note">
                        <ul style="margin: 0.5rem 0; padding-left: 1.2rem;">
                            <li>Your password can't be too similar to your other personal information.</li>
                            <li>Your password must contain at least 8 characters.</li>
                            <li>Your password can't be a commonly used password.</li>
                            <li>Your password can't be entirely numeric.</li>
                        </ul>
                    </div>
                    <div id="password-strength" class="password-strength"></div>
                </div>

                <!-- Поле password2 -->
                <div class="InputField">
                    <label for="id_password2">Confirm Password *</label>
                    <input type="password"
                           name="password2"
                           id="id_password2"
                           class="Input {% if form.password2.errors %}error{% endif %}"
                           required
                           placeholder="Confirm your password"
                           autocomplete="new-password">
                    {% if form.password2.errors %}
                    <div class="error-text">
                        {% for error in form.password2.errors %}
                        <span class="error-message">{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <div id="password-match" class="form-note"></div>
                </div>

                <div class="ButtonGroup">
                    <button type="submit" class="button button--primary">Register</button>
                </div>
            </form>

            <p class="auth-switch">Already have an account? <a href="{% url 'users:login' %}">Sign in</a></p>
        </div>
    </div>
</main>

<!-- Footer -->
<footer>
    <img src="{% static 'img/background/image-footer.svg' %}" alt="Hop & Barley Hops Logo" class="footer__hops-logo">
    <nav class="footer__nav">
        <ul>
            <li><a href="#">Contact</a></li>
            <li><a href="#">FAQ</a></li>
            <li><a href="#">Community</a></li>
            <li><a href="#">Resources</a></li>
            <li><a href="#">License</a></li>
        </ul>
    </nav>
    <p class="footer__copyright">© Hop & Barley 2026. All rights reserved</p>
</footer>

<!-- Link to your main JavaScript file -->
<script src="{% static 'js/main.js' %}"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('register-form');
    const password1 = document.getElementById('id_password1');
    const password2 = document.getElementById('id_password2');
    const strengthDisplay = document.getElementById('password-strength');
    const matchDisplay = document.getElementById('password-match');

    // Список распространенных паролей
    const commonPasswords = [
        'password', '123456', '12345678', '123456789', '12345',
        'qwerty', 'abc123', 'password1', '1234567', '111111',
        'admin', 'letmein', 'welcome', 'monkey', 'football'
    ];

    // Проверка сложности пароля
    function checkPasswordStrength(password) {
        let strength = 0;

        if (password.length >= 8) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[a-z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^A-Za-z0-9]/.test(password)) strength++;
        if (!commonPasswords.includes(password.toLowerCase())) strength++;

        return strength;
    }

    // Обновление отображения сложности пароля
    function updatePasswordStrength() {
        const password = password1.value;

        if (!password) {
            strengthDisplay.textContent = '';
            strengthDisplay.className = 'password-strength';
            return;
        }

        const strength = checkPasswordStrength(password);
        let message = '';
        let className = '';

        if (strength <= 2) {
            message = 'Weak password';
            className = 'strength-weak';
        } else if (strength <= 4) {
            message = 'Medium password';
            className = 'strength-medium';
        } else {
            message = 'Strong password';
            className = 'strength-strong';
        }

        strengthDisplay.textContent = message;
        strengthDisplay.className = `password-strength ${className}`;
    }

    // Проверка совпадения паролей
    function checkPasswordMatch() {
        if (!password1.value || !password2.value) {
            matchDisplay.textContent = '';
            password2.classList.remove('error');
            return;
        }

        if (password1.value === password2.value) {
            matchDisplay.textContent = '✓ Passwords match';
            matchDisplay.style.color = '#28a745';
            password2.classList.remove('error');
        } else {
            matchDisplay.textContent = '✗ Passwords do not match';
            matchDisplay.style.color = '#dc3545';
            password2.classList.add('error');
        }
    }

    // Валидация формы
    function validateForm(e) {
        let isValid = true;

        // Проверка совпадения паролей
        if (password1.value !== password2.value) {
            alert('Passwords do not match!');
            password2.focus();
            isValid = false;
        }

        // Проверка сложности пароля
        if (password1.value && checkPasswordStrength(password1.value) <= 2) {
            if (!confirm('Your password seems weak. Are you sure you want to use it?')) {
                password1.focus();
                isValid = false;
            }
        }

        // Проверка на распространенные пароли
        if (commonPasswords.includes(password1.value.toLowerCase())) {
            alert('This password is too common. Please choose a stronger one.');
            password1.focus();
            isValid = false;
        }

        if (!isValid) {
            e.preventDefault();
        }

        return isValid;
    }

    // События
    if (password1) {
        password1.addEventListener('input', updatePasswordStrength);
        password1.addEventListener('blur', updatePasswordStrength);
    }

    if (password1 && password2) {
        password2.addEventListener('input', checkPasswordMatch);
        password2.addEventListener('blur', checkPasswordMatch);
    }

    if (form) {
        form.addEventListener('submit', validateForm);
    }

    // Автофокус на первом поле с ошибкой
    const firstError = document.querySelector('.Input.error');
    if (firstError) {
        firstError.focus();
    }

    // Очистка ошибок при фокусе
    const inputs = document.querySelectorAll('.Input');
    inputs.forEach(input => {
        input.addEventListener('focus', function() {
            this.classList.remove('error');
            const errorDiv = this.parentElement.querySelector('.error-text');
            if (errorDiv) {
                errorDiv.style.display = 'none';
            }
        });
    });
});
</script>
</body>
</html>