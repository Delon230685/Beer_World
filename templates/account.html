{% extends 'base.html' %}
{% load static %}

{% block title %}My Account | Hop & Barley{% endblock %}

{% block content %}
<div class="account-page-wrapper">
    <div class="container">
        <div class="account-container">
            <!-- Сообщения Django -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Tabs Navigation -->
            <div class="account-tabs">
                <button class="account-tab active" data-tab="order-history">Order History</button>
                <button class="account-tab" data-tab="account-info">Account Information</button>
            </div>

            <!-- Tabs Content -->
            <div class="tab-content">
                <!-- Order History Panel -->
                <div id="order-history" class="tab-pane active">
                    <div class="order-history-table">
                        <!-- Table Header -->
                        <div class="order-table-header">
                            <div class="order-table-cell">Order Details</div>
                            <div class="order-table-cell">Order Status</div>
                            <div class="order-table-cell">Total</div>
                        </div>

                        <!-- Table Body -->
                        <div class="order-table-body">
                            {% if orders %}
                                {% for order in orders %}
                                <div class="order-table-row">
                                    <div class="order-table-cell">
                                        <span class="order-id">#{{ order.id }}</span>
                                        <span class="order-date">{{ order.created_at|date:"d M Y" }}</span>
                                    </div>
                                    <div class="order-table-cell">
                                        <span class="order-status status-{{ order.status }}">
                                            {{ order.get_status_display }}
                                        </span>
                                    </div>
                                    <div class="order-table-cell">
                                        <span class="order-total">${{ order.total_price|floatformat:2 }}</span>
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="no-orders">
                                    <i class="fa-solid fa-box-open"></i>
                                    <p>You haven't placed any orders yet.</p>
                                    <a href="{% url 'product_list' %}" class="button button--primary">
                                        <i class="fa-solid fa-store"></i>
                                        Start Shopping
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Account Information Panel -->
                <div id="account-info" class="tab-pane">
                    <div class="account-form-container">
                        <h2 class="account-form-title">Personal Information</h2>

                        <form method="post" action="{% url 'users:account' %}">
                            {% csrf_token %}

                            <div class="checkout-form-group">
                                <label for="id_username">Username</label>
                                <input type="text"
                                       id="id_username"
                                       name="username"
                                       class="Input"
                                       value="{{ user.username }}"
                                       readonly
                                       disabled>
                                <small class="form-note">Username cannot be changed</small>
                            </div>

                            <div class="checkout-form-group">
                                <label for="id_first_name">First Name</label>
                                <input type="text"
                                       id="id_first_name"
                                       name="first_name"
                                       class="Input"
                                       value="{{ user.first_name|default:'' }}"
                                       placeholder="Enter your first name">
                            </div>

                            <div class="checkout-form-group">
                                <label for="id_last_name">Last Name</label>
                                <input type="text"
                                       id="id_last_name"
                                       name="last_name"
                                       class="Input"
                                       value="{{ user.last_name|default:'' }}"
                                       placeholder="Enter your last name">
                            </div>

                            <div class="checkout-form-group">
                                <label for="id_email">Email</label>
                                <input type="email"
                                       id="id_email"
                                       name="email"
                                       class="Input"
                                       value="{{ user.email|default:'' }}"
                                       placeholder="example@mail.com"
                                       required>
                            </div>

                            <div class="form-divider">
                                <h3 class="form-subtitle">Change Password</h3>
                                <p class="form-note">Leave blank if you don't want to change</p>
                            </div>

                            <div class="checkout-form-group">
                                <label for="id_password1">New Password</label>
                                <input type="password"
                                       id="id_password1"
                                       name="password1"
                                       class="Input"
                                       placeholder="Enter new password">
                            </div>

                            <div class="checkout-form-group">
                                <label for="id_password2">Confirm New Password</label>
                                <input type="password"
                                       id="id_password2"
                                       name="password2"
                                       class="Input"
                                       placeholder="Confirm new password">
                            </div>

                            <div class="button-group">
                                <button type="submit" class="button button--primary button--full-width">
                                    <i class="fa-solid fa-save"></i>
                                    Save Changes
                                </button>
                            </div>
                        </form>

                        <div class="form-divider">
                            <h3 class="form-subtitle">Account Actions</h3>
                        </div>

                        <form method="post" action="{% url 'users:logout' %}" class="logout-form">
                            {% csrf_token %}
                            <button type="submit" class="button button--secondary button--full-width">
                                <i class="fa-solid fa-sign-out-alt"></i>
                                Logout
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .no-orders {
        padding: 48px 24px;
        text-align: center;
        background-color: var(--background-default);
        border-radius: 8px;
        color: var(--grey-text);
    }

    .no-orders i {
        font-size: 48px;
        margin-bottom: 16px;
        color: var(--border-default);
    }

    .order-status {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 16px;
        font-size: 14px;
        font-weight: 500;
    }

    .status-pending {
        background-color: #fff3cd;
        color: #856404;
    }

    .status-paid, .status-confirmed {
        background-color: #d4edda;
        color: #155724;
    }

    .status-shipped {
        background-color: #cce5ff;
        color: #004085;
    }

    .status-delivered {
        background-color: #d1e7dd;
        color: #0f5132;
    }

    .status-cancelled {
        background-color: #f8d7da;
        color: #721c24;
    }

    .form-divider {
        margin: 24px 0 16px;
        border-top: 1px solid var(--border-default);
        padding-top: 16px;
    }

    .form-subtitle {
        font-size: 18px;
        font-weight: 600;
        color: var(--black-main);
        margin-bottom: 8px;
    }

    .form-note {
        font-size: 14px;
        color: var(--grey-text);
        margin-bottom: 16px;
    }

    .button--full-width {
        width: 100%;
        margin-top: 8px;
    }

    .alert {
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 24px;
    }

    .alert-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .alert-error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }

    .alert-info {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Переключение табов
    const tabs = document.querySelectorAll('.account-tab');
    const panes = document.querySelectorAll('.tab-pane');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Убираем активный класс у всех табов
            tabs.forEach(t => t.classList.remove('active'));
            
            // Добавляем активный класс текущему табу
            this.classList.add('active');
            
            // Получаем ID целевой панели
            const targetId = this.dataset.tab;
            
            // Скрываем все панели
            panes.forEach(pane => pane.classList.remove('active'));
            
            // Показываем целевую панель
            document.getElementById(targetId).classList.add('active');
        });
    });
    
    // Подтверждение выхода
    const logoutForm = document.querySelector('.logout-form');
    if (logoutForm) {
        logoutForm.addEventListener('submit', function(e) {
            if (!confirm('Are you sure you want to logout?')) {
                e.preventDefault();
            }
        });
    }
});
</script>
{% endblock %}