"""
Контекстные процессоры для корзины.
Делают информацию о корзине доступной во всех шаблонах.
"""
from .cart import Cart


def cart(request):
    """
    Добавляет объект корзины в контекст всех шаблонов.
    Возвращаем ТОЛЬКО количество товаров, без итерации по корзине!
    """
    cart_obj = Cart(request)

    # ✅ НЕ вызываем __iter__! Только безопасные методы
    return {
        'cart': cart_obj,
        'cart_items_count': len(cart_obj),  # __len__ безопасен!
    }